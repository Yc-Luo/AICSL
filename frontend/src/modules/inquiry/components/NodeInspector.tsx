import React from 'react';
import { useInquiryStore } from '../store/useInquiryStore';
import { useInquiryActions } from './InquiryContext';
import { Button } from '../../../components/ui/button';
import {
    Trash2,
    MessageSquare,
    ShieldCheck,
    ShieldAlert,
    Reply,
    X
} from 'lucide-react';

interface NodeInspectorProps { }

export const NodeInspector: React.FC<NodeInspectorProps> = () => {
    const { nodes } = useInquiryStore();
    const { updateNode, deleteNode } = useInquiryActions();

    const selectedNode = nodes.find(n => n.selected);

    if (!selectedNode) return null;

    const nodeTypes = [
        { type: 'claim', label: '核心主张', icon: MessageSquare, color: 'text-blue-500' },
        { type: 'evidence', label: '有力证据', icon: ShieldCheck, color: 'text-emerald-500' },
        { type: 'counter-argument', label: '相反观点', icon: ShieldAlert, color: 'text-rose-500' },
        { type: 'rebuttal', label: '有力回击', icon: Reply, color: 'text-amber-500' },
    ];

    return (
        <div className="absolute right-4 top-24 z-20 w-72 bg-white/90 backdrop-blur-md rounded-2xl shadow-2xl border border-slate-200 overflow-hidden animate-in slide-in-from-right-4">
            <div className="p-4 bg-slate-50 border-b flex justify-between items-center">
                <h3 className="text-sm font-bold text-slate-700">编辑节点</h3>
                <Button variant="ghost" size="icon" className="h-6 w-6 rounded-full" onClick={() => updateNode(selectedNode.id, { selected: false })}>
                    <X className="w-4 h-4" />
                </Button>
            </div>

            <div className="p-4 space-y-4">
                {/* 类型选择 */}
                <div className="space-y-2">
                    <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">节点类型</label>
                    <div className="grid grid-cols-2 gap-2">
                        {nodeTypes.map((item) => (
                            <Button
                                key={item.type}
                                variant={selectedNode.type === item.type ? 'default' : 'outline'}
                                size="sm"
                                className="h-9 px-2 flex justify-start gap-2"
                                onClick={() => updateNode(selectedNode.id, { type: item.type })}
                            >
                                <item.icon className={`w-3.5 h-3.5 ${selectedNode.type === item.type ? '' : item.color}`} />
                                <span className="text-[10px] truncate">{item.label}</span>
                            </Button>
                        ))}
                    </div>
                </div>

                {/* 内容编辑 */}
                <div className="space-y-2">
                    <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">文字内容</label>
                    <textarea
                        className="w-full h-32 p-3 text-sm rounded-xl border border-slate-200 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none outline-none"
                        value={selectedNode.data.content || ''}
                        onChange={(e) => updateNode(selectedNode.id, {
                            data: { ...selectedNode.data, content: e.target.value }
                        })}
                    />
                </div>

                <div className="pt-2 border-t mt-4 flex justify-between items-center">
                    <Button
                        variant="ghost"
                        size="sm"
                        className="text-red-500 hover:text-red-600 hover:bg-red-50 gap-2"
                        onClick={() => deleteNode(selectedNode.id)}
                    >
                        <Trash2 className="w-4 h-4" />
                        删除节点
                    </Button>
                </div>
            </div>
        </div>
    );
};
